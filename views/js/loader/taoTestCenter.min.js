!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/format",["lodash"],factory):(global=global||self)["core/format"]=factory(global._)}(this,function(_){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_;var pattern=/(%[sdj])/g;return function(message){var replacements=Array.prototype.slice.call(arguments,1);return _.reduce(message.match(pattern),function(acc,match,index){var replacement="";if(void 0!==replacements[index]){switch(match){case"%d":replacement=Number(replacements[index]);break;case"%j":try{replacement=JSON.stringify(
replacements[index]).replace(/"/g,"")}catch(e){}break;default:replacement=replacements[index]}message=message.replace(match,replacement)}return message},message)}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("context")):"function"==typeof define&&define.amd?define("util/url",["lodash","context"],factory):(global=global||self)["util/url"]=factory(global._,global.context)}(this,function(_,context){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,context=context&&context.hasOwnProperty("default")?context.default:context;var parsers={absolute:/^(?:[a-z]+:)?\/\//i,
base64:/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/,query:/(?:^|&)([^&=]*)=?([^&]*)/g,url:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/};return{parse:function(url){var matches,keys=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","queryString","hash"],i=keys.length,parsed=Object.create({toString:function(){return this.source}});if(parsed.base64=parsers.base64.test(url),parsed.base64)parsed.source=url;else{for(matches=parsers.url.exec(url);i--;)parsed[keys[i]]=matches[i]||"";parsed.query={},
parsed.queryString.replace(parsers.query,function($0,$1,$2){$1&&(parsed.query[$1]=$2)})}return parsed},isAbsolute:function(url){return"object"==typeof url&&url.hasOwnProperty("source")?url.source!==url.relative:"string"==typeof url?parsers.absolute.test(url):void 0},isRelative:function(url){var absolute=this.isAbsolute(url);if("boolean"==typeof absolute)return!absolute},isBase64:function(url){return"object"==typeof url&&url.hasOwnProperty("source")?url.base64:"string"==typeof url?parsers.base64.test(url):void 0},encodeAsXmlAttr:function(uri){return/[<>&']+/.test(uri)?encodeURIComponent(uri):uri},build:function(path,params){var url,hasQueryString,
queryString="";return path&&(_.isString(path)&&(url=path),_.isArray(path)&&(url="",_.forEach(path,function(chunk){/\/$/.test(url)&&/^\//.test(chunk)?url+=chunk.substr(1):""===url||/\/$/.test(url)||/^\//.test(chunk)?url+=chunk:url+="/"+chunk})),_.isPlainObject(params)&&(hasQueryString=-1<url.indexOf("?"),queryString=_.reduce(params,function(acc,value,key){return _.isEmpty(acc)&&!hasQueryString||(acc+="&"),"object"!=typeof value||_.isArray(value)?acc+=encodeURIComponent(key)+"="+encodeURIComponent(value):_.forOwn(value,function(parameterValue,parameterName){acc+=encodeURIComponent(key)+"["+encodeURIComponent(parameterName)+"]="+encodeURIComponent(
parameterValue)+"&"}),acc},queryString),_.isEmpty(queryString)||(hasQueryString||(url+="?"),url+=queryString))),url},route:function(action,controller,extension,params,rootUrl){var routeParts=[extension,controller,action];if(_.some(routeParts,function(value){return _.isEmpty(value)||!_.isString(value)}))throw new TypeError("All parts are required to build an URL");return rootUrl=rootUrl||context&&context.root_url,this.build([rootUrl].concat(routeParts),params)}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/encode",factory):(global=global||self
)["util/encode"]=factory()}(this,function(){"use strict";var _reQuot=/"/g,_reApos=/'/g,encodeHTML=function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML};return{html:encodeHTML,attribute:function(html){return encodeHTML(html).replace(_reQuot,"&quot;").replace(_reApos,"&apos;")},encodeBase64:function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},decodeBase64:function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}}),
function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("core/promise",factory):(global=global||self)["core/promise"]=factory()}(this,function(){"use strict";return Promise}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/format"),require("core/promise")):"function"==typeof define&&define.amd?define("core/logger/api",["lodash","core/format","core/promise"],factory):(global=global||self)["core/logger/api"]=factory(global._,global["core/format"],global["core/promise"])}(this,function(_
,format,Promise){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,format=format&&format.hasOwnProperty("default")?format.default:format,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise;function loggerFactory(name,minLevel,fields){var baseRecord,logger;if(!_.isString(name)||_.isEmpty(name))throw new TypeError("A logger needs a name");return _.isPlainObject(minLevel)&&"undefined"==typeof field&&(fields=minLevel,minLevel=defaultLevel),baseRecord=_.defaults(fields||{},{name:name,pid:1,hostname:navigator.userAgent}),logger={log:function(level,recordFields,message){var record,err,rest=[],time=(new Date).toISOString();if(
!1!==loggerFactory.providers&&checkMinLevel(minLevel||defaultLevel,level))return rest=_.isString(recordFields)||recordFields instanceof Error?(message=recordFields,recordFields={},[].slice.call(arguments,2)):[].slice.call(arguments,3),record={level:getLevel(level),v:0,time:time},checkMinLevel(levels.error,level)||message instanceof Error?(err=message instanceof Error?message:(message=_.isObject(message)?JSON.stringify(message):message,new Error(message)),record.msg=err.message,record.err=err):record.msg=format.apply(null,[message].concat(rest)),_.merge(record,baseRecord,recordFields),logQueue.push(record),loggerFactory.flush(),this},level:function(value){
return void 0!==value?(minLevel=getLevelNum(value),this):getLevel(minLevel)},child:function(childFields){return loggerFactory(name,minLevel,_.defaults(childFields,baseRecord))}},_.reduce(levels,function(target,level,levelName){return target[levelName]=_.partial(logger.log,level),target},logger)}var defaultLevel="info",levels={fatal:60,error:50,warn:40,info:30,debug:20,trace:10},logQueue=[],getLevel=function(level){return void 0===level||_.isString(level)&&!_.has(levels,level)?defaultLevel:_.isNumber(level)?_.findKey(levels,function(l){return l===level})||defaultLevel:level},getLevelNum=function(level){return _.isString(level)&&_.has(levels,level
)?levels[level]:_.isNumber(level)&&_.contains(levels,level)?level:levels[defaultLevel]},checkMinLevel=function(minLevel,level){return getLevelNum(level)>=getLevelNum(minLevel)};return loggerFactory.levels=levels,loggerFactory.providers=!1,loggerFactory.load=function(providerConfigs){var self=this,modules=[];return this.providers=[],new Promise(function(resolve,reject){_.forEach(providerConfigs,function(providerConfig,providerName){modules.push(providerName)}),require(modules,function(){var loadedProviders=[].slice.call(arguments);_.forEach(loadedProviders,function(provider,moduleKey){try{self.register(provider,providerConfigs[modules[moduleKey]])}catch(err){
reject(err)}}),self.flush(),resolve()},reject)})},loggerFactory.register=function(provider,providerConfig){if(!_.isPlainObject(provider)||!_.isFunction(provider.log))throw new TypeError("A log provider is an object with a log method");provider.checkMinLevel=checkMinLevel,_.isFunction(provider.setConfig)&&provider.setConfig(providerConfig),this.providers=this.providers||[],this.providers.push(provider)},loggerFactory.flush=function(){_.isArray(this.providers)&&0<this.providers.length&&(_.forEach(logQueue,function(message){_.forEach(loggerFactory.providers,function(provider){provider.log.call(provider,message)})}),logQueue=[])},
loggerFactory.setDefaultLevel=function(level){return defaultLevel=getLevel(level)},loggerFactory}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("module"),require("core/logger/api")):"function"==typeof define&&define.amd?define("core/logger",["lodash","module","core/logger/api"],factory):(global=global||self)["core/logger"]=factory(global._,global.module,global["core/logger/api"])}(this,function(_,module,loggerFactory){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,module=module&&module.hasOwnProperty("default")?module.default:module;var defaultConfig={level:(
loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory.default:loggerFactory).levels.warn,loggers:{"core/logger/console":{level:"warn"}}},config=_.defaults(module.config()||{},defaultConfig),logger=loggerFactory("core/logger");return loggerFactory.setDefaultLevel(config.level),loggerFactory.load(config.loggers),window.onerror=function(msg,url,line,col,error){logger.error("Caught[via window.onerror]: '"+msg+"' from "+url+":"+line+":"+col)},window.setTaoLogLevel=function(level){return loggerFactory.setDefaultLevel(level)},loggerFactory}),function(global,factory){
"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("lib/uuid"),require("core/logger")):"function"==typeof define&&define.amd?define("core/eventifier",["lodash","core/promise","lib/uuid","core/logger"],factory):(global=global||self)["core/eventifier"]=factory(global._,global["core/promise"],global["lib/uuid"],global["core/logger"])}(this,function(_,Promise,uuid,loggerFactory){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid.default:uuid,
loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory.default:loggerFactory;var defaultNs="@",eventifierLogger=loggerFactory("core/eventifier");function getEventNames(eventNames){return!_.isString(eventNames)||_.isEmpty(eventNames)?[]:_(eventNames.split(/\s/g)).compact().uniq().value()}function getName(eventName){return-1<eventName.indexOf(".")?eventName.substr(0,eventName.indexOf(".")):eventName}function getNamespace(eventName){return-1<eventName.indexOf(".")?eventName.substr(eventName.indexOf(".")+1):defaultNs}return function(target){var targetName,logger,stoppedEvents,eventHandlers={},getHandlers=function(eventName,type){
var name=getName(eventName),ns=getNamespace(eventName);return type=type||"between",eventHandlers[ns]=eventHandlers[ns]||{},eventHandlers[ns][name]=eventHandlers[ns][name]||{before:[],between:[],after:[]},eventHandlers[ns][name][type]},eventApi={on:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName).push(handler)}),this},off:function(eventNames){return _.forEach(getEventNames(eventNames),function(eventName){var offNamespaces,name=getName(eventName),ns=getNamespace(eventName);ns&&!name?"*"===ns?((offNamespaces={})[defaultNs]=eventHandlers[defaultNs],
eventHandlers=offNamespaces):eventHandlers[ns]={}:_.forEach(eventHandlers,function(nsHandlers,namespace){!nsHandlers[name]||ns!==defaultNs&&ns!==namespace||(nsHandlers[name]={before:[],between:[],after:[]})})}),this},removeAllListeners:function(){return eventHandlers={},this},trigger:function(eventNames){var self=this,args=[].slice.call(arguments,1);function triggerBetween(allHandlers,event){shouldStop(event.name)?logHandlerStop("before",event):triggerHandlers(allHandlers.between,event).then(function(){!function(handlers,event){shouldStop(event.name)?logHandlerStop("on",event):triggerHandlers(handlers,event).then(function(){shouldStop(event.name
)&&logHandlerStop("after",event)}).catch(function(err){logHandlerStop("after",event,err)})}(allHandlers.after,event)}).catch(function(err){logHandlerStop("on",event,err)})}function triggerHandlers(handlers,event){var pHandlers;return pHandlers=handlers.map(function(handler){return shouldStop(event.name)?Promise.reject():handler.apply(self,args)}),Promise.all(pHandlers)}function logHandlerStop(stoppedIn,event,err){err instanceof Error&&logger.error(err),logger.trace({err:err,event:event.name,stoppedIn:stoppedIn},event.name+" handlers stopped")}function shouldStop(name){return stoppedEvents[name]}return stoppedEvents={},_.forEach(getEventNames(eventNames),
function(eventName){var ns=getNamespace(eventName),name=getName(eventName),mergedHandlers=_(eventHandlers).filter(function(nsHandlers,namespace){return nsHandlers[name]&&(ns===defaultNs||ns===namespace||"*"===namespace)}).reduce(function(acc,nsHandlers){return acc.before=acc.before.concat(nsHandlers[name].before),acc.between=acc.between.concat(nsHandlers[name].between),acc.after=acc.after.concat(nsHandlers[name].after),acc},{before:[],between:[],after:[]});logger.trace({event:eventName,args:args},"trigger %s",eventName),mergedHandlers&&function(allHandlers,name,ns){var event={name:name,namespace:ns};allHandlers.before.length?function(handlers,event){
var pHandlers,beforeArgs=args.slice();return beforeArgs.unshift(event),pHandlers=handlers.map(function(handler){var value=!shouldStop(event.name)&&handler.apply(self,beforeArgs);return!1===value?Promise.reject():value}),Promise.all(pHandlers)}(allHandlers.before,event).then(function(){triggerBetween(allHandlers,event)}).catch(function(err){logHandlerStop("before",event,err)}):triggerBetween(allHandlers,event)}(mergedHandlers,name,ns)}),this},before:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"before").push(handler)}),this},after:function(eventNames,handler){
return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"after").push(handler)}),this},stopEvent:function(name){_.isString(name)&&!_.isEmpty(name.trim())&&(stoppedEvents[name.trim()]=!0)},spread:function(destination,eventNames){var self=this;return destination&&_.isFunction(destination.trigger)&&(_.isString(eventNames)&&(eventNames=getEventNames(eventNames)),_.forEach(eventNames,function(eventName){self.on(eventName,function(){var args=[eventName].concat([].slice.call(arguments));destination.trigger.apply(destination,args)})})),this}};return targetName=(target=target||{}
).name||target.id||target.serial||uuid(6),logger=eventifierLogger.child({target:targetName}),_(eventApi).functions().forEach(function(method){_.isFunction(target[method])&&eventifierLogger.warn("The target object has already a method named "+method,target),target[method]=function(){var args=[].slice.call(arguments);return eventApi[method].apply(target,args)}}),target}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/regexEscape",factory):(global=global||self)["util/regexEscape"]=factory()}(this,function(){"use strict";return function(s){
return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("util/regexEscape")):"function"==typeof define&&define.amd?define("util/wrapLongWords",["util/regexEscape"],factory):(global=global||self)["util/wrapLongWords"]=factory(global["util/regexEscape"])}(this,function(regexEscape){"use strict";regexEscape=regexEscape&&regexEscape.hasOwnProperty("default")?regexEscape.default:regexEscape;var getCutTerm=function(longWord,chunkExp){for(var cutTerms=longWord.match(chunkExp),i=cutTerms.length,oldFirst="",newFirst="",offenders=[".",":",";"];i--;
)newFirst=cutTerms[i].charAt(0),-1<offenders.indexOf(newFirst)&&(cutTerms[i]=cutTerms[i].substr(1)),-1<offenders.indexOf(oldFirst)&&(cutTerms[i]=cutTerms[i]+oldFirst),oldFirst=newFirst;return cutTerms.join(" ")};return function(str,threshold){str=str.toString().replace(/([\w])</g,"$1 <");for(var cut,chunkExp=new RegExp(".{1,"+threshold+"}","g"),longWords=str.match(new RegExp("[\\S]{"+threshold+",}","g"))||[],i=longWords.length;i--;)cut=getCutTerm(longWords[i],chunkExp),str=str.replace(new RegExp(regexEscape(longWords[i]),"g"),cut);return str}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require(
"lodash")):"function"==typeof define&&define.amd?define("util/namespace",["lodash"],factory):(global=global||self)["util/namespace"]=factory(global._)}(this,function(_){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_;var reSplit=/\s/g,namespaceHelper={split:function(names,normalize){return!_.isString(names)||_.isEmpty(names)?[]:(normalize&&(names=names.toLowerCase()),_(names.trim().split(reSplit)).compact().uniq().value())},getName:function(namespaced){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(".")?namespaced.substr(0,namespaced.indexOf(".")):namespaced},getNamespace:function(namespaced,defaultNs){
return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(".")?namespaced.substr(namespaced.indexOf(".")+1):defaultNs||"@"},namespaceAll:function(names,namespace,normalize){var suffix;return _.isArray(names)||(names=namespaceHelper.split(names,normalize)),normalize&&(namespace=namespace.toLowerCase()),suffix=namespace?"."+namespace:"",_(names).map(function(sh){return sh.indexOf(".")<0?sh+suffix:sh}).compact().uniq().value().join(" ")}};return namespaceHelper}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash"),require("util/namespace")
):"function"==typeof define&&define.amd?define("util/shortcut/registry",["jquery","lodash","util/namespace"],factory):(global=global||self)["util/shortcut/registry"]=factory(global.$,global._,global["util/namespace"])}(this,function($,_,namespaceHelper){"use strict";$=$&&$.hasOwnProperty("default")?$.default:$,_=_&&_.hasOwnProperty("default")?_.default:_,namespaceHelper=namespaceHelper&&namespaceHelper.hasOwnProperty("default")?namespaceHelper.default:namespaceHelper;var modifiers={ctrl:"ctrlKey",alt:"altKey",option:"altKey",shift:"shiftKey",meta:"metaKey",cmd:"metaKey",win:"metaKey"},translateKeys={escape:"esc",arrowdown:"down",arrowleft:"left",
arrowright:"right",arrowup:"up"},specialKeys={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"meta",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",145:"scrolllock",144:"numlock"};function registerEvent(target,eventName,listener){target.addEventListener?target.addEventListener(eventName,listener,!1):target.attachEvent?target.attachEvent("on"+eventName,listener):target["on"+eventName]=listener}function unregisterEvent(target,eventName,listener){
target.removeEventListener?target.removeEventListener(eventName,listener,!1):target.detachEvent?target.detachEvent("on"+eventName,listener):target["on"+eventName]=null}function normalizeCommand(descriptor){var key=translateKeys[descriptor.key]||descriptor.key,parts=[];return descriptor.ctrlKey&&parts.push("control"),descriptor.altKey&&parts.push("alt"),descriptor.shiftKey&&parts.push("shift"),descriptor.metaKey&&parts.push("meta"),descriptor.scrollDown&&parts.push("scrollDown"),descriptor.scrollUp&&parts.push("scrollUp"),descriptor.clickLeft&&parts.push("clickLeft"),descriptor.clickRight&&parts.push("clickRight"),descriptor.clickMiddle&&parts.push(
"clickMiddle"),descriptor.clickBack&&parts.push("clickBack"),descriptor.clickForward&&parts.push("clickForward"),key&&parts.indexOf(key)<0&&parts.push(key),parts.join("+")}function parseCommand(shortcut){var parts=namespaceHelper.getName(shortcut).split("+"),descriptor={keyboardInvolved:!1,mouseClickInvolved:!1,mouseWheelInvolved:!1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,key:null,scrollUp:null,scrollDown:null,clickLeft:null,clickRight:null,clickMiddle:null,clickBack:null,clickForward:null};return _.forEach(parts,function(part){if(modifiers[part])descriptor[modifiers[part]]=!0;else if(0<=part.indexOf("mouse")){if(descriptor.keyboardInvolved
)throw new Error("A shortcut cannot involve both mouse and regular keys!");0<=part.indexOf("scroll")&&(descriptor.mouseWheelInvolved=!0,descriptor.scrollUp=0<=part.indexOf("up"),descriptor.scrollDown=0<=part.indexOf("down")),0<=part.indexOf("click")&&(descriptor.mouseClickInvolved=!0,descriptor.clickLeft=0<=part.indexOf("left"),descriptor.clickRight=0<=part.indexOf("right"),descriptor.clickMiddle=0<=part.indexOf("middle"),descriptor.clickBack=0<=part.indexOf("back"),descriptor.clickForward=0<=part.indexOf("forward"))}else{if(descriptor.mouseClickInvolved||descriptor.mouseWheelInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!")
;descriptor.keyboardInvolved=!0,descriptor.key=part}}),descriptor}return function(root,defaultOptions){var keyboardIsRegistered=!1,mouseClickIsRegistered=!1,mouseWheelIsRegistered=!1,keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,shortcuts={},handlers={},states={};function getHandlers(command,namespace){return handlers[namespace]=handlers[namespace]||{},handlers[namespace][command]=handlers[namespace][command]||[],handlers[namespace][command]}function getCommandHandlers(command){return _.reduce(handlers,function(acc,nsHandlers){return nsHandlers[command]&&(acc=acc.concat(nsHandlers[command])),acc},[])}function setOptions(descriptor,options){
descriptor.options=_.defaults(_.merge(descriptor.options||{},options),defaultOptions)}function unregisterKeyboard(){--keyboardCount<=0&&(keyboardCount=0,keyboardIsRegistered&&(unregisterEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!1))}function unregisterMouseClick(){--mouseClickCount<=0&&(mouseClickCount=0,mouseClickIsRegistered&&(unregisterEvent(root,"click",onMouseClick),mouseClickIsRegistered=!1))}function unregisterMouseWheel(){--mouseWheelCount<=0&&(mouseWheelCount=0,mouseWheelIsRegistered&&(unregisterEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!1))}function registerCommand(command,descriptor){(shortcuts[command]=descriptor
).keyboardInvolved&&(keyboardIsRegistered||(registerEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!0),keyboardCount++),descriptor.mouseClickInvolved&&(mouseClickIsRegistered||(registerEvent(root,"click",onMouseClick),mouseClickIsRegistered=!0),mouseClickCount++),descriptor.mouseWheelInvolved&&(mouseWheelIsRegistered||(registerEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!0),mouseWheelCount++)}function onKeyboard(event){processShortcut(event,{keyboardInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey,key:function(event){var code=event.which||event.keyCode,
character=32<=code?String.fromCharCode(code).toLowerCase():"",key=event.key&&event.key.toLowerCase(),keyName=event.code&&event.code.toLowerCase();return keyName&&(0===keyName.indexOf("key")?(key<"a"||"z"<key)&&"a"<=character&&character<="z"&&(key=character):0===keyName.indexOf("digit")&&(key=keyName.substr(5))),specialKeys[code]||key||character}(event)})}function onMouseClick(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},function(event){var buttons={clickLeft:!1,clickRight:!1,clickMiddle:!1,clickBack:!1,clickForward:!1};if(event.buttons
)buttons.clickLeft=!!(1&event.buttons),buttons.clickRight=!!(2&event.buttons),buttons.clickMiddle=!!(4&event.buttons),buttons.clickBack=!!(8&event.buttons),buttons.clickForward=!!(16&event.buttons);else switch(event.button){case 0:buttons.clickLeft=!0;break;case 1:buttons.clickMiddle=!0;break;case 2:buttons.clickRight=!0;break;case 3:buttons.clickBack=!0;break;case 4:buttons.clickForward=!0}return buttons}(event)))}function onMouseWheel(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},function(event){return{scrollUp:event.deltaY<0,scrollDown:0<event.deltaY}}(
event)))}function processShortcut(event,descriptor){var shortcutHandlers,$target,command=normalizeCommand(descriptor),shortcut=shortcuts[command];if(shortcut&&!states.disabled){if(!0===shortcut.options.avoidInput&&($target=$(event.target)).closest('[type="text"],textarea').length&&(!shortcut.options.allowIn||!$target.closest(shortcut.options.allowIn).length))return;!1===shortcut.options.propagate&&event.stopPropagation(),!0===shortcut.options.prevent&&event.preventDefault(),(shortcutHandlers=getCommandHandlers(command))&&_.forEach(shortcutHandlers,function(handler){handler(event,command)})}}return root.jquery&&(root=root.get(0)),{set:function(shortcut,
options){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor)}),this},add:function(shortcut,handler,options){return _.isFunction(handler)&&_.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor),getHandlers(command,namespace).push(handler)}),this},remove:function(shortcut){return _.forEach(
namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),command=normalizeCommand(parseCommand(normalized));!function(command,namespace){namespace&&!command?handlers[namespace]={}:_.forEach(handlers,function(nsHandlers,ns){!nsHandlers[command]||"*"!==namespace&&namespace!==ns||(nsHandlers[command]=[])})}(command,namespace),getCommandHandlers(command).length||function(command){var descriptor=shortcuts[command];shortcuts[command]=null,descriptor&&(descriptor.keyboardInvolved&&unregisterKeyboard(),descriptor.mouseClickInvolved&&unregisterMouseClick(),descriptor.mouseWheelInvolved&&unregisterMouseWheel())
}(command)}),this},exists:function(shortcut){var normalized=String(shortcut).trim().toLowerCase(),namespace=namespaceHelper.getNamespace(normalized,"*"),command=normalizeCommand(parseCommand(normalized)),shortcutExists=!1;return shortcuts[command]?shortcutExists="*"===namespace||!!getHandlers(command,namespace).length:command||(shortcutExists=!_.isEmpty(handlers[namespace])),shortcutExists},clear:function(){return shortcuts={},handlers={},mouseWheelCount=mouseClickCount=keyboardCount=0,unregisterKeyboard(),unregisterMouseClick(),unregisterMouseWheel(),this},getState:function(name){return!!states[name]},setState:function(name,state){
return states[name]=!!state,this},enable:function(){return this.setState("disabled",!1),this},disable:function(){return this.setState("disabled",!0),this}}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash")):"function"==typeof define&&define.amd?define("core/pluginifier",["jquery","lodash"],factory):(global=global||self)["core/pluginifier"]=factory(global.$,global._)}(this,function($,_){"use strict";$=$&&$.hasOwnProperty("default")?$.default:$,_=_&&_.hasOwnProperty("default")?_.default:_;var basePlugin={options:function(dataNs,ns,options){return this.each(function(){
var $elt=$(this),currentOptions=$elt.data(dataNs);currentOptions&&$elt.data(dataNs,_.merge(currentOptions,options))})},disable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.addClass(options.disableClass||"disabled").trigger("disable."+ns)})},enable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.removeClass(options.disableClass||"disabled").trigger("enable."+ns)})}};return{register:function(pluginName,plugin,config){var ns=(config=config||{}).ns||pluginName.toLowerCase(),dataNs=config.dataNs||"ui."+ns,expose=config.expose||[]
;return _.isFunction($.fn[pluginName])?$.error("A plugin named "+pluginName+" is already registered"):_.isPlainObject(plugin)&&_.isFunction(plugin.init)?(_.assign(plugin,_.transform(basePlugin,function(result,prop,key){_.isFunction(prop)&&(result[key]=_.partial(basePlugin[key],dataNs,ns))})),_.forEach(expose,function(toExposeName){var privateMethod=toExposeName,publicMethod=toExposeName;/^_/.test(expose)?publicMethod=publicMethod.replace(/^_/,""):privateMethod="_"+privateMethod,_.isFunction(plugin[privateMethod])&&!_.isFunction(plugin[publicMethod])&&(plugin[publicMethod]=function(){var returnValue,args=Array.prototype.slice.call(arguments,0)
;return this.each(function(){returnValue=plugin[privateMethod].apply(plugin,[$(this)].concat(args))}),returnValue||this})}),void($.fn[pluginName]=function(method){if(plugin[method]){if(!/^_/.test(method))return plugin[method].apply(this,Array.prototype.slice.call(arguments,1));$.error("Trying to call a private method `"+method+"`")}else if("object"==typeof method||!method)return plugin.init.apply(this,arguments);$.error("Method "+method+" does not exist on plugin")})):$.error("The object to register as a jQuery plugin must be a plain object with an `init` method.")}}}),function(global,factory){
"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash")):"function"==typeof define&&define.amd?define("core/dataattrhandler",["jquery","lodash"],factory):(global=global||self)["core/dataattrhandler"]=factory(global.$,global._)}(this,function($,_){"use strict";$=$&&$.hasOwnProperty("default")?$.default:$,_=_&&_.hasOwnProperty("default")?_.default:_;var defaults={container:!1,listenerEvent:"click",useTarget:!0,bubbled:!1},letDefaultOn=[":radio",":checkbox"],shouldPreventDefault=function($elt){return!$elt.is(letDefaultOn.join(","))},DataAttrHandler=function(attrName,options){var self=this
;this.options=_.defaults(options,defaults);var selector="[data-"+attrName+"]";if(!_.has(this.options,"namespace")||!_.isString(this.options.namespace))return $.error("The plugin data namespace option is required");this.options.container&&this.options.container.selector&&(selector=this.options.container.selector+" "+selector),this.options.inner&&(selector+=" "+this.options.inner),$(document).off(this.options.listenerEvent,selector).on(this.options.listenerEvent,selector,function(e){var $target,$outer,$elt=$(e.target);!0!==self.options.bubbled&&!$elt.is(selector)||(void 0===$elt.data(attrName)&&(self.options.inner||self.options.bubbled)&&($elt=($outer=$elt
).parents("[data-"+attrName+"]")),$target=!0===self.options.useTarget?DataAttrHandler.getTarget(attrName,$elt):self.options.inner?$outer:void 0,$elt.data(self.options.namespace)||("function"==typeof self.createPlugin&&self.createPlugin($elt,$target),$elt.is(":radio")&&$elt.attr("name")&&$(':radio[name="'+$elt.attr("name")+'"]').not($elt).on(self.options.listenerEvent,function(e){"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()})),"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault())})}
;return DataAttrHandler.prototype.init=function(cb){return this.createPlugin=cb,this},DataAttrHandler.prototype.trigger=function(cb){return this.callPluginMethod=cb,this},DataAttrHandler.getTarget=function(attrName,$elt){var relativeRegex=/^(\+|>|~|:parent|<)/,$target=[],targetSelector=$elt.attr("data-"+attrName)||$elt.attr("href")||$elt.attr("attrName");if(!_.isEmpty(targetSelector)){var matches=relativeRegex.exec(targetSelector);if(null!==matches){var selector=targetSelector.replace(relativeRegex,"");$target=":parent"===matches[0]||"<"===matches[0]?$elt.parents(selector):"~"===matches[0]?$elt.siblings(selector):"+"===matches[0]?$elt.next(selector):$(
selector,$elt)}else $target=$(targetSelector)}return $target},DataAttrHandler}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("util/shortcut/registry")):"function"==typeof define&&define.amd?define("util/shortcut",["util/shortcut/registry"],factory):(global=global||self)["util/shortcut"]=factory(global["util/shortcut/registry"])}(this,function(shortcutRegistry){"use strict";return(shortcutRegistry=shortcutRegistry&&shortcutRegistry.hasOwnProperty("default")?shortcutRegistry.default:shortcutRegistry)(window,{propagate:!1,prevent:!0})}),define("tpl!taoTestCenter/component/proctorForm/form",[
"handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helper,buffer="";return buffer+='<div class="proctor-form section-container">\n    <div class="content-block">\n        ',!(stack1=(helper=(helpers=this.merge(helpers,Handlebars.helpers)).form)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.form)?helper.call(depth0,{hash:{},data:data}):helper)&&0!==stack1||(buffer+=stack1),buffer+="\n    </div>\n</div>"})}),define("taoTestCenter/component/proctorForm",["lodash","jquery","i18n","helpers","users","ui/feedback","ui/component",
"taoProctoring/helper/textConverter","tpl!taoTestCenter/component/proctorForm/form"],function(_,$,__,helpers,users,feedback,component,textConverter,formTpl){"use strict";var _ns=".proctor-form",proctorFormUrl=helpers._url("createProctorForm","ProctorManager","taoTestCenter"),proctorLoginCheckUrl=helpers._url("checkLogin","ProctorManager","taoTestCenter");function renderFormFromData($container,formData){$container.html(formTpl({form:formData.form})),users.checkLogin(formData.loginId,proctorLoginCheckUrl)}return helpers.init(),function(config){return component().on("destroy",function(){this.getElement().off(_ns).empty()}).on("render",function(){var self=this,
$element=this.getElement();textConverter().then(function(labels){$.get(proctorFormUrl,function(formData){renderFormFromData($element,formData),$element.on("submit"+_ns,"form",function(e){var fields=$(this).serializeArray(),list=self.config.testCenterList,data={testCenters:list&&list.getSelection()};_.each(fields,function(field){data[field.name]=field.value}),$.post(proctorFormUrl,data,function(res){res.created?(feedback().success(labels.get("Proctor created")),self.destroy()):renderFormFromData($element,res)}),e.preventDefault()}).on("click","button.btn-diasble",function(){self.destroy()})})}).catch(function(err){console.log(err)})}).init(config)}}),define(
"tpl!taoTestCenter/templates/proctorManager/counters",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;function program2(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="',stack1=(helper=helpers.cls)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.cls)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"><span class="text">',stack1=(
helper=helpers.label)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.label)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'</span>: <span class="count">',stack1=(helper=helpers.count)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.count)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span></div>"}return(stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,buffer="";return buffer+="\n    ",!(stack1=helpers.if.call(depth0,depth0&&depth0.count,{hash:{},
inverse:self.noop,fn:self.program(2,program2,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n"},data),data:data}))||0===stack1?stack1:""})}),define("tpl!taoTestCenter/templates/proctorManager/status",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,buffer="",helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression,functionType="function";return!(stack1=helpers.if.call(depth0,depth0&&depth0.authorized,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var helper,options
,buffer="";return buffer+=escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Authorized",options):helperMissing.call(depth0,"__","Authorized",options)))+' <span class="icon icon-authorize"></span>'},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n",!(stack1=helpers.if.call(depth0,depth0&&depth0.partially,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var stack1,helper,options,buffer="";return buffer+='<span title="',stack1=(helper=helpers.testCenters)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.testCenters)===functionType?helper.call(depth0,{
hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Partially authorized",options):helperMissing.call(depth0,"__","Partially authorized",options)))+"</span>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer})}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/providerRegistry",["lodash"],factory):(global=global||self)["core/providerRegistry"]=factory(global._)}(this,function(_){"use strict"
;return _=_&&_.hasOwnProperty("default")?_.default:_,function(target,validator){var _providers={};return(target=target||{}).registerProvider=function(name,provider){var valid=!0;if(!_.isString(name)||name.length<=0)throw new TypeError("It is required to give a name to your provider.");if(!_.isPlainObject(provider)||!_.isFunction(provider.init))throw new TypeError("A provider is an object that contains at least an init function.");return(valid=validator&&_.isFunction(validator)?validator(provider):valid)&&(_providers[name]=provider),this},target.getProvider=function(providerName){var provider;if(!_providers||0===_.size(_providers))throw new Error(
"No provider registered");if(_.isString(providerName)&&0<providerName.length?provider=_providers[providerName]:1===_.size(_providers)&&(providerName=_.keys(_providers)[0],provider=_providers[providerName]),!provider)throw new Error("No candidate found for the provider");return provider},target.getAvailableProviders=function(){return _.keys(_providers)},target.clearProviders=function(){return _providers={},this},target}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/httpErrorParser",factory):(global=global||self)["util/httpErrorParser"]=factory()}(this
,function(){"use strict";return{parse:function(xhr,options,errorThrown){var msg,json,error;try{msg=(json=JSON.parse(xhr.responseText)).message?json.message:errorThrown}catch(e){msg=errorThrown}return(error=new Error(msg)).response=xhr,error.code=xhr.status,error.errorThrown=errorThrown,error}}}),define("taoTestCenter/controller/ProctorManager/index",["lodash","jquery","i18n","layout/loading-bar","util/url","util/encode","ui/feedback","ui/dialog/confirm","ui/bulkActionPopup","ui/datalist","ui/button","taoTestCenter/component/proctorForm","taoProctoring/helper/textConverter","tpl!taoTestCenter/templates/proctorManager/counters",
"tpl!taoTestCenter/templates/proctorManager/status","ui/datatable"],function(_,$,__,loadingBar,urlHelper,encode,feedback,dialogConfirm,bulkActionPopup,datalist,buttonFactory,proctorForm,textConverter,counterTpl,statusTpl){"use strict";var indexUrl=urlHelper.route("index","TestCenter","taoTestCenter"),proctorsDataUrl=urlHelper.route("proctorAuthorizations","ProctorManager","taoTestCenter"),authorizeUrl=urlHelper.route("authorize","ProctorManager","taoTestCenter"),unauthorizeUrl=urlHelper.route("unauthorize","ProctorManager","taoTestCenter"),_modes_EMPTY=0,_modes_LIST=1,_modes_FORM=2;return loadingBar.start(),{start:function(){textConverter().then(function(
labels){var $container=$(".proctorManager-index"),$panelSelection=$(".test-center-panel"),$containerList=$(".proctor-list"),$containerForm=$(".proctor-create"),$noSelection=$(".proctor-default"),testCenters=$container.data("list"),pageMode=_modes_EMPTY,list=datalist({renderTo:$panelSelection,textNumber:__("Test sites"),labelText:__("Test site"),selectable:!0},testCenters);function request(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testCenters:list.getSelection(),proctors:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){if(loadingBar.stop(),
response&&response.success)message&&feedback().success(message),$containerList.datatable("refresh");else{var errorMessage=__("Something went wrong ...");response.proctors&&(errorMessage=__("No authorization to revoke for these proctors :"),errorMessage+="</ul>",response.proctors.forEach(function(proctor){errorMessage+="<li>"+proctor+"</li>"}),errorMessage+="</ul>"),feedback().error(errorMessage,{encodeHtml:!1})}}))}function authorize(selection,message){dialogConfirm(message,function(){request(authorizeUrl,selection,labels.get("Proctors authorized"))})}function revoke(selection,message){dialogConfirm(message,function(){request(unauthorizeUrl,selection,
labels.get("Proctors revoked"))})}function processMode(selection){if(selection.length)switch(pageMode){case _modes_EMPTY:pageMode=_modes_LIST;case _modes_LIST:$containerList.datatable("options",{params:{testCenters:null}}).datatable("options",{params:{testCenters:selection}}).datatable("refresh")}else _modes_LIST===pageMode?pageMode=_modes_EMPTY:_modes_EMPTY!==pageMode&&feedback().warning(__("You must select at least one test center!"));$noSelection.toggleClass("hidden",_modes_EMPTY!==pageMode),$containerList.toggleClass("hidden",_modes_LIST!==pageMode),$containerForm.toggleClass("hidden",_modes_FORM!==pageMode)}buttonFactory({id:"back",type:"info",label:__(
"Back to index"),cls:"back-button",renderTo:$container.find(".header")}).on("click",function(){window.location.href=indexUrl}),list.on("select",function(selection){processMode(selection)}),$containerList.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(e,dataset){var partially=0,authorized=0,lines=dataset&&dataset.data;_.forEach(lines,function(line){if(line&&line.status)switch(line.status){case 1:partially++;break;case 2:authorized++}}),$(this).find(".datatable-wrapper h2").append(counterTpl([{id:"authorized-list",label:labels.get("Authorized proctors"),count:authorized},{id:"partially-list",label:labels.get(
"Partially authorized proctors"),count:partially}])),loadingBar.stop()}).datatable({url:proctorsDataUrl,status:{empty:labels.get("No assigned proctors"),available:labels.get("Assigned proctors"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$containerList.datatable("refresh")}},{id:"create",icon:"add",title:labels.get("Creates and authorizes proctor"),label:labels.get("Create Proctor"),action:function(){var selection=list.getSelection();proctorForm({renderTo:$containerForm,testCenterList:list}).on("destroy",function(){pageMode=_modes_LIST,processMode(list.getSelection())}),
pageMode=_modes_FORM,processMode(selection)}},{id:"authorize",icon:"authorize",title:labels.get("Authorize the selected proctors"),label:__("Authorize"),massAction:!0,action:function(selection){authorize(selection,labels.get("The proctors will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",title:labels.get("Revoke authorization for the selected proctors"),label:__("Revoke"),massAction:!0,action:function(selection){revoke(selection,labels.get("The proctors will be revoked. Continue ?"))}}],actions:[{id:"authorize",icon:"authorize",title:labels.get("Authorize the proctor"),hidden:function(){return 2===this.status},action:function(id){authorize([id],
labels.get("The proctor will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",title:labels.get("Revoke the proctor"),hidden:function(){return!this.status},action:function(id){revoke([id],labels.get("The proctor will be revoked. Continue ?"))}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"login",label:__("Login")},{id:"state",label:__("Status"),transform:function(value,row){return statusTpl({testCenters:row.authorized,partially:1===row.status,authorized:2===row.status})}}]},[]),loadingBar.stop()}).catch(function(err){console.error(err)})}}}),define("taoTestCenter/controller/routes",{
ProctorManager:{actions:{index:"controller/ProctorManager/index"}},TestCenterManager:{actions:{editCenter:"controller/TestCenterManager/editCenter"}},TestCenter:{actions:{index:"controller/TestCenter/index",testCenter:"controller/TestCenter/testCenter"}}}),define("taoTestCenter/controller/TestCenter/index",["jquery","i18n","util/url","layout/loading-bar","ui/listbox","ui/button","taoProctoring/helper/textConverter"],function($,__,urlHelper,loadingBar,listBox,buttonFactory,textConverter){"use strict";return loadingBar.start(),{start:function(){textConverter().then(function(labels){function update(boxes){list.update(boxes),loadingBar.stop()}var $container=$(
".testcenters-index"),admin=$container.data("administrator"),boxes=$container.data("list"),list=listBox({title:__("My Test sites"),textEmpty:__("No test site available"),textNumber:__("Available"),textLoading:__("Loading"),renderTo:$container.find(".content"),replace:!0}),serviceUrl=urlHelper.route("index","TestCenter","taoTestCenter"),adminUrl=urlHelper.route("index","ProctorManager","taoTestCenter");boxes?update(boxes):(loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)})),admin&&buttonFactory({id:"manage-proctors",type:"info",icon:"users",
cls:"manage-button",label:labels.get("Manage Proctors"),renderTo:$container.find(".header")}).on("click",function(){window.location.href=adminUrl})}).catch(function(err){console.log(err)})}}}),define("taoTestCenter/controller/TestCenter/testCenter",["jquery","i18n","util/url","layout/loading-bar","ui/listbox"],function($,__,urlHelper,loadingBar,listBox){"use strict";return loadingBar.start(),{start:function(){function update(boxes){list.update(boxes),loadingBar.stop()}var $container=$(".testcenters-testcenter"),boxes=$container.data("list"),title=($container.data("id"),$container.data("title")),list=listBox({title:title,textEmpty:!1,textNumber:!1,
textLoading:__("Loading"),renderTo:$container.find(".content"),replace:!0,width:12}),serviceUrl=urlHelper.route("testCenter","TestCenter","taoTestCenter");boxes?update(boxes):(loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)}))}}}),define("tpl!taoTestCenter/component/eligibilityEditor/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helper,options,buffer="",helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)
).helperMissing,escapeExpression=this.escapeExpression,functionType="function";function program3(depth0,data){return"flex-col-12"}function program5(depth0,data){return"flex-col-6"}return buffer+='<div class="eligibility-editor',!(stack1=helpers.if.call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){return" editing"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='">\n    <h2 class="title">',stack1=(helper=helpers.title)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.title)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'</h2>\n\n    <div class="flex-grid ">\n        <div class="',!(stack1=helpers.if.call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:this.program(5,program5,data),fn:this.program(3,program3,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+=' tree-container eligible-delivery">\n            <label>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Eligible Deliveries",options):helperMissing.call(depth0,"__","Eligible Deliveries",options)))+'</label>\n                <div id="',stack1=(helper=helpers.deliveryTreeId)?helper.call(depth0,{hash:{},data:data}):typeof(
helper=depth0&&depth0.deliveryTreeId)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"></div>\n        </div>\n        <div class="',!(stack1=helpers.if.call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:this.program(5,program5,data),fn:this.program(3,program3,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+=' tree-container eligible-testTaker">\n            <label>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Eligible Test Takers",options):helperMissing.call(depth0,"__","Eligible Test Takers",options)))+" ",!(stack1=helpers.if.call(
depth0,depth0&&depth0.editingMode,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var stack1,helper,options,buffer="";return buffer+=escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"for",options):helperMissing.call(depth0,"__","for",options)))+' <span class="delivery-name">',stack1=(helper=helpers.deliveryName)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.deliveryName)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span> :"},data),data:data}))&&0!==stack1||(buffer+=stack1),
buffer+='</label>\n                <div id="',stack1=(helper=helpers.subjectTreeId)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.subjectTreeId)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"></div>\n        </div>\n    </div>\n    <div class="actions">\n        <button class="btn btn-info small done">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"OK",options):helperMissing.call(depth0,"__","OK",options)))+'</button>\n        <a href="#" class="btn cancel" title="'+escapeExpression((options={hash:{},data:data},(
helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"cancel the action",options):helperMissing.call(depth0,"__","cancel the action",options)))+'">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"cancel",options):helperMissing.call(depth0,"__","cancel",options)))+"</a>\n    </div>\n</div>"})}),define("css!taoTestCenterCss/eligibilityEditor",[],function(){}),define("taoTestCenter/component/eligibilityEditor",["jquery","lodash","i18n","module","util/url","uri","ui/component","generis.tree.select","tpl!taoTestCenter/component/eligibilityEditor/layout","ui/feedback","ui/modal",
"css!taoTestCenterCss/eligibilityEditor"],function($,_,__,module,url,uri,component,GenerisTreeSelectClass,layoutTpl,feedback){"use strict";var _ns=".eligibility-editor",_modalDefaults={width:600},config={dataUrl:url.route("getData","GenerisTree","tao"),deliveriesOrder:"http://www.w3.org/2000/01/rdf-schema#label",deliveriesOrderdir:"asc",isDacEnabled:!1,testTakerDataUrl:url.route("getData","TestCenterManager","taoTestCenter")};config=_.defaults({},module.config(),config),_.isObject(config.testTakerDataUrl)?config.testTakerDataUrl=url.route(config.testTakerDataUrl.action,config.testTakerDataUrl.controller,config.testTakerDataUrl.extension
):config.testTakerDataUrl=config.dataUrl;return function(){var eligibilityEditor,testTakerTreeId=_.uniqueId("eligible-testTaker-tree-"),deliveryTreeId=_.uniqueId("eligible-delivery-tree-"),buildTestTakerTree=function(id,url,testTakers,isDacEnabled){var selected=_.pluck(testTakers,"uri");return void 0===isDacEnabled&&(isDacEnabled=config.isDacEnabled),new GenerisTreeSelectClass("#"+id,url,{actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.map(selected,uri.encode),serverParameters:{openParentNodes:selected,rootNode:"http://www.tao.lu/Ontologies/TAOSubject.rdf#Subject"},paginate:10,checkResourcePermissions:isDacEnabled})},
destroyModal=function(){eligibilityEditor&&eligibilityEditor.getElement()&&eligibilityEditor.getElement().modal("destroy").remove()},initModal=function(modalConfig){modalConfig=_.defaults(modalConfig||{},_modalDefaults),eligibilityEditor&&eligibilityEditor.getElement()&&eligibilityEditor.getElement().addClass("modal").on("closed.modal",destroyModal).modal(modalConfig)};return eligibilityEditor=component({add:function($container,options){return this.on("render",function(){var deliveryTree,testTakerTree,self=this;options=_.defaults(options||{},this.config),deliveryTree=function(id,url,deliveries){var selected=_.pluck(deliveries,"uri")
;return new GenerisTreeSelectClass("#"+id,url,{actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.map(selected,uri.encode),serverParameters:{openParentNodes:selected,rootNode:"http://www.tao.lu/Ontologies/TAODelivery.rdf#AssembledDelivery",order:config.deliveriesOrder,orderdir:config.deliveriesOrderdir},paginate:10})}(deliveryTreeId,options.dataUrl),testTakerTree=buildTestTakerTree(testTakerTreeId,options.testTakerDataUrl,[],options.isDacEnabled),initModal({width:650}),this.$component.on("click"+_ns,".actions .done",function(e){var deliveries=_(deliveryTree.getChecked()).uniq().compact().value(),testTakers=_(
testTakerTree.getChecked()).uniq().compact().value();deliveries&&deliveries.length?(self.trigger("ok",{deliveries:deliveries,testTakers:testTakers}),destroyModal()):feedback(self.$component).warning(__("At least one delivery need to be selected to create"))}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),destroyModal(),self.trigger("cancel")}),this.trigger("open")}).init({title:__("Add Eligibility"),editingMode:!1,subjectTreeId:testTakerTreeId,deliveryTreeId:deliveryTreeId}).render($container).resize()},edit:function($container,deliveryName,testTakers,options){return this.on("render",function(){var testTakerTree,self=this
;options=_.defaults(options||{},this.config),testTakerTree=buildTestTakerTree(testTakerTreeId,options.testTakerDataUrl,testTakers,options.isDacEnabled),initModal({width:400}),this.$component.on("click"+_ns,".actions .done",function(e){var testTakers=_(testTakerTree.getChecked()).uniq().compact().value();self.trigger("ok",{testTakers:testTakers}),destroyModal()}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),destroyModal(),self.trigger("cancel")}),this.trigger("open")}).init({title:__("Edit Eligibility"),editingMode:!0,subjectTreeId:testTakerTreeId,deliveryTreeId:deliveryTreeId,deliveryName:deliveryName}).render($container).resize()},
resize:function(){return eligibilityEditor.getElement().css({top:"40px","overflow-y":"auto"}),eligibilityEditor.getElement().css("max-height",$(window).height()-2*parseInt(eligibilityEditor.getElement().css("top"),10)+"px"),this}},config).setTemplate(layoutTpl)}}),define("tpl!taoTestCenter/component/eligibilityTable/status",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression;return(stack1=helpers.if.call(depth0,depth0&&depth0.byPassProctor,{
hash:{},inverse:this.program(3,function(depth0,data){var helper,options,buffer="";return buffer+='\n    <span class="icon-shield txt-success" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"This delivery needs proctor authorization",options):helperMissing.call(depth0,"__","This delivery needs proctor authorization",options)))+'"></span>\n'},data),fn:this.program(1,function(depth0,data){var helper,options,buffer="";return buffer+='\n    <span class="icon-unshield txt-danger" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,
"This delivery can be launched without authorization",options):helperMissing.call(depth0,"__","This delivery can be launched without authorization",options)))+'"></span>\n'},data),data:data}))||0===stack1?stack1:""})}),define("tpl!taoTestCenter/component/eligibilityTable/actions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression,self=this;function program2(depth0,data){var helper,options,buffer=""
;return buffer+='\n        <button class="btn-info small edit" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Enable proctor authorization",options):helperMissing.call(depth0,"__","Enable proctor authorization",options)))+'" data-action="shield">\n            <span class="icon-shield"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Proctor",options):helperMissing.call(depth0,"__","Proctor",options)))+"\n        </button>\n    "}function program4(depth0,data){var helper,options,buffer=""
;return buffer+='\n        <button class="btn-info small edit" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Remove proctor authorization",options):helperMissing.call(depth0,"__","Remove proctor authorization",options)))+'" data-action="unshield">\n            <span class="icon-unshield"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Un-Proctor",options):helperMissing.call(depth0,"__","Un-Proctor",options)))+"\n        </button>\n    "}return(stack1=helpers.if.call(depth0,depth0&&depth0.allowedToWrite,{hash:{},
inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n    <button class="btn-info small edit" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Edit eligibile test takers",options):helperMissing.call(depth0,"__","Edit eligibile test takers",options)))+'" data-action="edit">\n        <span class="icon-edit"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Edit",options):helperMissing.call(depth0,"__","Edit",options)))+"\n    </button>\n\n    ",!(stack1=helpers.if.call(depth0
,depth0&&depth0.byPassProctor,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n\n    <button class="btn-info small remove" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Remove eligibility",options):helperMissing.call(depth0,"__","Remove eligibility",options)))+'" data-action="remove">\n        <span class="icon-bin"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Remove",options):helperMissing.call(depth0,"__","Remove",options))
)+"\n    </button>\n"},data),data:data}))||0===stack1?stack1:""})}),define("css!taoTestCenterCss/eligibilityTable",[],function(){}),define("taoTestCenter/component/eligibilityTable",["jquery","lodash","i18n","ui/component","helpers","tpl!taoTestCenter/component/eligibilityTable/status","tpl!taoTestCenter/component/eligibilityTable/actions","css!taoTestCenterCss/eligibilityTable.css","ui/datatable"],function($,_,__,component,helpers,statusTpl,actionsTpl){"use strict";return function(testCenterId,permissions){var tableComponent,eligibilities=[],tools=[],allowedToWrite=!1;if(_.isEmpty(testCenterId))throw new TypeError(
"The eligibility provider needs to be initialized with a test center");return(!permissions||permissions&&permissions.WRITE)&&(allowedToWrite=!0,tools=[{id:"add",icon:"add",title:__("Add"),label:__("Add"),action:function(){tableComponent.trigger("add",eligibilities)}},{id:"import",icon:"import",title:__("Import"),label:__("Import"),action:function(){tableComponent.trigger("import",eligibilities)}}]),tableComponent=component({},{dataUrl:helpers._url("getEligibilities","TestCenterManager","taoTestCenter",{uri:testCenterId})}).on("render",function(){var self=this;this.$component.on("query.datatable",function(){self.trigger("loading")}).on("load.datatable",
function(e){self.trigger("loaded")}).on("beforeload.datatable",function(e,dataSet){dataSet&&dataSet.data&&(eligibilities=dataSet.data)}).datatable({url:this.config.dataUrl,status:{empty:__("No Eligible Delivery yet"),available:__("Eligible Deliveries"),loading:__("Loading")},tools:tools,model:[{id:"status",label:"",transform:function(value,row){return statusTpl(row)}},{id:"deliveryLabel",label:__("Delivery"),transform:function(value,row){return row.delivery.label}},{id:"testTakersCount",label:__("Eligible Test Takers"),transform:function(value,row){return row.testTakers&&row.testTakers.length?row.testTakers.length:0}},{id:"actions",label:__("Actions"),
transform:function(value,row){return row.allowedToWrite=allowedToWrite,actionsTpl(row)}}],selectable:!1}).on("click",".actions button",function(e){e.preventDefault();var $button=$(this),itemId=$button.parents("[data-item-identifier]").data("item-identifier"),action=$button.data("action");self.trigger(action,itemId,eligibilities)})}).on("reload",function(){this.$component&&this.$component.datatable("refresh")})}}),define("tpl!taoTestCenter/component/eligibilityImport/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var helper,buffer="";return buffer+='<div id="eligibility-import">\n    <div class="report-container">\n        <div class="section-header flex-container-full">\n            <h2>',buffer+=(0,this.escapeExpression)((helper=helpers.title)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.title)?helper.call(depth0,{hash:{},data:data}):helper)+'</h2>\n        </div>\n        <div class="main-container flex-container-full report"></div>\n    </div>\n    <div id="upload-container"></div>\n</div>'})}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(
):"function"==typeof define&&define.amd?define("util/bytes",factory):(global=global||self)["util/bytes"]=factory()}(this,function(){"use strict";return{hrSize:function(bytes){var unit=0;for(bytes=bytes||0;1024<=bytes;)bytes/=1024,unit++;return bytes.toFixed(2)+["B","kB","MB","GB","TB"][unit]}}}),define("taoTestCenter/component/eligibilityImport",["jquery","lodash","i18n","module","helpers","uri","ui/component","tpl!taoTestCenter/component/eligibilityImport/layout","ui/feedback","ui/report","layout/loading-bar","async","ui/modal","css!taoTestCenterCss/eligibilityEditor","ui/uploader"],function($,_,__,module,helpers,uri,component,layoutTpl,feedback,
reportFactory,loadingBar,async){"use strict";var _ns=".eligibility-import",_fileTypeFilters=["text/csv","application/vnd.ms-excel"],_fileExtFilter=/.+\.(csv)$/,_modalDefaults={width:600};return function(datatable,testCenterId){var eligibilityImport,config={uploadUrl:helpers._url("import","TestCenterManager","taoTestCenter",{uri:testCenterId})};if(_.isEmpty(testCenterId))throw new TypeError("The eligibility provider needs to be initialized with a test center");var destroyModal=function(){eligibilityImport&&eligibilityImport.getElement()&&(datatable.trigger("reload"),eligibilityImport.getElement().modal("destroy").remove())};var initModal=function(modalConfig
){modalConfig=_.defaults(modalConfig||{},_modalDefaults),eligibilityImport&&eligibilityImport.getElement()&&eligibilityImport.getElement().addClass("modal").on("closed.modal",destroyModal).modal(modalConfig),function(){var errors=[],$uploader=$("#upload-container"),$reportContainer=$(".report-container");$uploader.on("upload.uploader",function(e,file,data){return reportFactory({actions:[{id:"continue",icon:"right",title:"continue",label:__("Continue")}]},data.report).on("action-continue",function(){destroyModal()}).render($reportContainer.find(".report"))}).on("fail.uploader",function(e,file,err){errors.push(__("Unable to upload file %s : %s",file.name,err))
}).on("end.uploader",function(){0<errors.length&&feedback().error(function(errors){return"<ul><li>"+errors.join("</li><li>")+"</li></ul>"}(errors),{encodeHtml:!1}),errors=[]}),$uploader.uploader({upload:!0,uploadUrl:config.uploadUrl,fileSelect:function(files,done){var givenLength=files.length;(files=_.filter(files,function(file){var checkType=file.type.replace(/("|')/g,"");return _.contains(_fileTypeFilters,checkType)||""===checkType&&_fileExtFilter.test(file.name)})).length!==givenLength&&feedback().error("Invalid files have been removed"),async.filter(files,function(file,cb){cb(!0)},done)}})}()};return eligibilityImport=component({add:function($container,
options){return this.on("render",function(){var self=this;options=_.defaults(options||{},this.config),initModal({width:650}),this.$component.on("click"+_ns,".actions .done",function(e){e.preventDefault(),destroyModal()}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),destroyModal(),self.trigger("cancel")}),this.trigger("open")}).init({title:__("Import Eligibilities from csv file."),editingMode:!1}).render($container).resize()},resize:function(){return eligibilityImport.getElement().css({top:"40px","overflow-y":"auto"}),eligibilityImport.getElement().css("max-height",$(window).height()-2*parseInt(eligibilityImport.getElement().css("top"),10
)+"px"),this}},config).setTemplate(layoutTpl)}}),define("taoTestCenter/provider/eligibility",["jquery","lodash","helpers","core/promise"],function($,_,helpers,Promise){"use strict";var request=function(action,parameters){return $.ajax({url:helpers._url(action,"TestCenterManager","taoTestCenter"),data:parameters,dataType:"json",type:"POST"})};return function(testCenterId){if(_.isEmpty(testCenterId))throw new TypeError("The eligibility provider needs to be initialized with a test center");return{addEligibilities:function(eligibilities){return new Promise(function(resolve,reject){if(!_.isPlainObject(eligibilities))return reject(new TypeError(
"Invalid eligibility"));request("addEligibilities",{uri:testCenterId,eligibility:eligibilities}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},editEligibility:function(eligibility){return new Promise(function(resolve,reject){if(!_.isPlainObject(eligibility))return reject(new TypeError("Invalid eligibility"));request("editEligibilities",{uri:testCenterId,eligibility:eligibility}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},removeEligibility:function(eligibility){return new Promise(function(resolve,reject){if(!_.isPlainObject(eligibility))return reject(new TypeError(
"Invalid eligibility"));request("removeEligibilities",{uri:testCenterId,eligibility:eligibility}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},shieldEligibility:function(eligibilityId){return new Promise(function(resolve,reject){_.isString(eligibilityId)||reject(new TypeError("Invalid eligibility")),request("shieldEligibility",{uri:testCenterId,eligibility:eligibilityId}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},unshieldEligibility:function(eligibilityId){return new Promise(function(resolve,reject){_.isString(eligibilityId)||reject(new TypeError("Invalid eligibility")),request(
"unshieldEligibility",{uri:testCenterId,eligibility:eligibilityId}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})}}}}),define("taoTestCenter/controller/TestCenterManager/editCenter",["jquery","lodash","i18n","layout/loading-bar","ui/feedback","taoTestCenter/component/eligibilityEditor","taoTestCenter/component/eligibilityTable","taoTestCenter/component/eligibilityImport","taoTestCenter/provider/eligibility"],function($,_,__,loadingBar,feedback,eligibilityEditorFactory,eligibilityTableFactory,eligibilityImportFactory,eligibilityProvider){"use strict";return{start:function(){var eligibilityTable,$container=$(
".eligible-deliveries"),$tableContainer=$(".eligibility-table-container",$container),$editorContainer=$(".eligibility-editor-container",$container),$editorImportContainer=$(".eligibility-import-container",$container),testCenterId=$container.data("testcenter"),permissions=!1;$container.data("dacenabled")&&(permissions=$container.data("permissions"));var loading=function(){loadingBar.start()},loaded=function(){loadingBar.stop()},handleError=function(err){loaded(),feedback().error(err.message)},success=function(message){loaded(),feedback().success(message),eligibilityTable.trigger("reload")};eligibilityTable=eligibilityTableFactory(testCenterId,permissions).on(
"loading",loading).on("loaded",loaded).on("add",function(){var self=this;eligibilityEditorFactory().add($editorContainer).on("ok",function(eligibility){loading(),eligibilityProvider(testCenterId).addEligibilities(eligibility).then(function(response){loaded(),response.failed&&response.failed.length?feedback().warning(__("The following delivery(ies) are already eligible : ")+response.failed.join(", ")):feedback().success(__("New eligible delivery added")),self.trigger("reload")}).catch(handleError)})}).on("edit",function(eligibilityId,eligibilities){var eligibility=_.find(eligibilities,{uri:eligibilityId});eligibilityEditorFactory().edit($editorContainer,
eligibility.delivery.label,eligibility.testTakers).on("ok",function(updated){loading(),eligibilityProvider(testCenterId).editEligibility({deliveries:[eligibility.delivery.uri],testTakers:updated.testTakers}).then(function(response){success(__("Eligible test takers updated"))}).catch(handleError)})}).on("remove",function(eligibilityId,eligibilities){var eligibility=_.find(eligibilities,{uri:eligibilityId});loading(),eligibilityProvider(testCenterId).removeEligibility({deliveries:[eligibility.delivery.uri]}).then(function(){success(__("Eligible delivery removed"))}).catch(handleError)}).on("shield",function(eligibilityId){loading(),eligibilityProvider(
testCenterId).shieldEligibility(eligibilityId).then(function(){success(__("Eligibility needs proctor authorization"))}).catch(handleError)}).on("unshield",function(eligibilityId){loading(),eligibilityProvider(testCenterId).unshieldEligibility(eligibilityId).then(function(){success(__("Eligibility don't need proctor authorization any more."))}).catch(handleError)}).on("import",function(){eligibilityImportFactory(this,testCenterId).add($editorImportContainer)}).init({}).render($tableContainer)}}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0][a](s),
s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}(
".eligibility-editor h2.title{margin-top:0}.eligibility-editor .tree-container label{top:10px}.eligibility-editor .tree{border:none}.eligibility-editor .eligible-delivery{margin-left:0}.eligibility-editor.editing .eligible-delivery{display:none}.eligibility-editor.editing .eligible-testTaker{margin-left:0}.eligibility-editor.editing .eligible-testTaker .delivery-name{font-weight:bold}.eligibility-editor .actions{margin-top:20px}.eligibility-editor .actions .btn{float:right;margin-left:20px}.eligibility-editor .actions .btn.cancel{position:relative;top:3px}\n\n/*# sourceMappingURL=eligibilityEditor.css.map */.eligible-deliveries th:last-child{text-align:center}.eligible-deliveries td.status{text-align:center;width:48px}.eligible-deliveries td.status>span{font-size:18px;font-size:1.8rem;vertical-align:bottom}\n\n/*# sourceMappingURL=eligibilityTable.css.map */"
),define("taoTestCenter/loader/taoTestCenter.bundle",function(){}),define("taoTestCenter/loader/taoTestCenter.min",["taoProctoring/loader/taoProctoring.min"],function(){});
//# sourceMappingURL=taoTestCenter.min.js.map